<!DOCTYPE html>

<html lang="en">
	<head>
		<% include ../partials/head %>
		<script type="text/javascript" src="https://cloud.tinymce.com/stable/tinymce.min.js?apiKey=yb2pwtctf7qznwdoo61w3kyj127j61gch5uhhzneop9mfkg7"></script>
		<script>
		tinymce.init({
				menubar: false,
				statusbar: false,			
				selector: "#tinymce",
				plugins: 'lists, link',
				valid_elements: '*[*]',
				toolbar: 'bold italic underline strikethrough | bullist numlist | outdent indent blockquote | subscript superscript | link',
				default_link_target: '_blank'
		});
		</script>

	</head>
 	
	<body>
	<% include ../partials/nav %>
	<div id="page-top">
	<section id="intro">
	<h1 class="section-heading" style="text-align:center;">Edit Blog</h1>
	<hr class="my-4"/>
		<div class="container">
		<div class="row">
		<div class="col-lg-12">
		
		
		<form id="imageForm" enctype="multipart/form-data">
			<label for="newimg">Add image</label>
			<input class="form-control" id="newimg" type="file" name="newimg">
		</form>
		
		<form method="POST" id="form" action=<%= "/b/edit/" +  doc._id %> >
			<div class="form-group">
			
			
				
				
					<hr class="py-2" style="max-width:75%;">
			
				<label for="title">Title</label> 
				<input type="text" class="form-control" id="title" name="title" value="<%= doc.title %>">
			
				<label for="category">Category</label> 
				<input type="text" class="form-control" id="category" name="category" value="<%= doc.category %>">
				
				<label for="lede">Lede</label> 
				<input type="text" class="form-control" id="lede" name="lede" value="<%= doc.lede %>">
			
			<p>Blog ID: <%= doc._id %></p>
			<p>Last Updated: <%= doc.date %>
			<p>Blog Ver: <%= doc.__v %>
			<p>Author ID: <%= doc.author %>
			
			
			<div class="form-group">
				
			</div>
			
			<p>Author: <%= doc.Author_Name %>
			<p>Author_BIO: <%= doc.Author_Bio %>
			<p>Contents:
			
				<div id="tinymce" name="tinymce"><%- doc.description %></div>
			
			
			
			
			
			<%
			if (doc.media[0]) {
				var image_temp = doc.media[0].image;
				var caption_temp = doc.media[0].caption;
			} else {
				var image_temp = "";
				var caption_temp = "";
			}
			%>
			<p>Media: <%= image_temp %>
			<img class="figure-img img-fluid rounded" src="<%= image_temp %>"></img>
			<p>Caption: <%= caption_temp %>
			</div>
			<input type="submit" class="btn btn-primary" type="Submit" />
		</form>
			
			
		</div></div></div>
		</section>
		</div>
		<% include ../partials/socialmedia %>
		<% include ../partials/footer %>
		
	</body>
	<script>
	$(document).ready(function () {
		$("#newimg").change(function(){
			alert('sdf');
			var formData = new FormData();
			FormData.append("newimg",
			$.ajax({
				method: 'POST',
				url: '/b/edits/uploadimg',
				data: $("#imageForm"),
				success: function (data) {
					console.log('Submission was successful.');
					console.log(data);
				},
				error: function (data) {
					console.log('An error occurred.');
					console.log(data);
				},
			});
		});
	});
	/**
	handleFile(id, i, e) {
						var self = this;
						self.file = e.target.files[0];
						var formData = new FormData();
						formData.append('img', self.file, self.file.name);
						$.ajax({
							url: '/b/edit/uploadimg/'+id+'?caption='+$("#caption").val(),
							method: 'POST',
							data: formData,
							processData: false,
							contentType: false,
							xhr: function () {
								var xhr = new XMLHttpRequest();

								// Add progress event listener to the upload.
								xhr.upload.addEventListener('progress', function (event) {
									self.progressBar = $('.progress-bar');

									if (event.lengthComputable) {
										var percent = (event.loaded / event.total) * 100;
										self.progressBar.width(percent + '%');

										if (percent === 100) {
											self.progressBar.removeClass('active');
										}
									}
								});
								return xhr;
							}
						}).done((result) => {
							console.log(result)
							self.vDoc = result;
							self.progressBar.removeClass('active');
							self.progressBar.width('0%');
							self.progressBar = null;
						}).fail(function (xhr, status) {
							alert(status);
						})
					}
		**/
	</script>
	
</html>